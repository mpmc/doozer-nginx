{
    "artifacts": [
        "nginx*.deb",
        "nginx*.changes",
    ],
    "targets": {
        "raspbian-stretch": {
            "environment": {
                "NGINX_URL": "http://nginx.org/packages/debian",
                "NGINX_KEY_URL": "http://nginx.org/keys/nginx_signing.key"
            },
            "buildenv": "raspbian-stretch",
            "builddeps": [
                "lsb-release",
                "wget",
                "coreutils",
                "apt-src",
                "sudo",
                "python3",
                "python3-apt",
                "ca-certificates",
            ],
            "buildcmd": [
                "cd ${WORKDIR}",
                "sudo mkdir -p /usr/local/share/ca-certificates/cacert.org",
                "sudo wget -P /usr/local/share/ca-certificates/cacert.org http://www.cacert.org/certs/root.crt http://www.cacert.org/certs/class3.crt",
                "sudo update-ca-certificates",
                "if [ ! -f nginx.key ]; then wget -O nginx.key ${NGINX_KEY_URL}; fi",
                "sudo apt-key add nginx.key",
                "echo \"deb ${NGINX_URL}/ $(lsb_release -sc) nginx\" | sudo tee /etc/apt/sources.list.d/nginx.list",
                "echo \"deb-src ${NGINX_URL}/ $(lsb_release -sc) nginx\" | sudo tee -a /etc/apt/sources.list.d/nginx.list",
                "sudo apt-src update && sudo apt-get update && sudo apt-get upgrade -y",
                "apt-src --build install nginx",
                "mv ./nginx*.{deb,changes,buildinfo} /project/repo/checkout",
            ]
        },
        "raspbian-stretch-with-rtmp": {
            "environment": {
                "NGINX_URL": "http://nginx.org/packages/debian",
                "NGINX_KEY_URL": "http://nginx.org/keys/nginx_signing.key",
                "RTMP_GIT_URL": "http://github.com/arut/nginx-rtmp-module.git",
                "RTMP_GIT_BRANCH": "master",
            },
            "buildenv": "raspbian-stretch",
            "builddeps": [
                "lsb-release",
                "wget",
                "coreutils",
                "apt-src",
                "sudo",
                "python3",
                "python3-apt",
                "git",
                "sed",
                "ca-certificates",
            ],
            "buildcmd": [
                "cd ${WORKDIR}",
                "sudo mkdir -p /usr/local/share/ca-certificates/cacert.org",
                "sudo wget -P /usr/local/share/ca-certificates/cacert.org http://www.cacert.org/certs/root.crt http://www.cacert.org/certs/class3.crt",
                "sudo update-ca-certificates",
                "git clone ${RTMP_GIT_URL} rtmp; cd rtmp && git checkout ${RTMP_GIT_BRANCH} && git pull;",
                "if [ ! -f nginx.key ]; then wget -O nginx.key ${NGINX_KEY_URL}; fi",
                "sudo apt-key add nginx.key",
                "echo \"deb ${NGINX_URL}/ $(lsb_release -sc) nginx\" | sudo tee /etc/apt/sources.list.d/nginx.list",
                "echo \"deb-src ${NGINX_URL}/ $(lsb_release -sc) nginx\" | sudo tee -a /etc/apt/sources.list.d/nginx.list",
                "apt-src update && sudo apt-get update && sudo apt-get upgrade -y",
                "apt-src install nginx",
                "sed -i 's#--modules-path=#--add-module=${WORKDIR}/rtmp --modules-path=#g' ./nginx-*/debian/rules",
                "apt-src build nginx",
                "mv ./nginx*.{deb,changes,buildinfo} /project/repo/checkout",
            ]
        },
        "stretch-amd64-with-rtmp": {
            "environment": {
                "NGINX_URL": "http://nginx.org/packages/debian",
                "NGINX_KEY_URL": "http://nginx.org/keys/nginx_signing.key",
                "RTMP_GIT_URL": "http://github.com/arut/nginx-rtmp-module.git",
                "RTMP_GIT_BRANCH": "master",
            },
            "buildenv": "stretch-amd64",
            "builddeps": [
                "lsb-release",
                "wget",
                "coreutils",
                "apt-src",
                "sudo",
                "python3",
                "python3-apt",
                "git",
                "sed",
                "ca-certificates",
            ],
            "buildcmd": [
                "cd ${WORKDIR}",
                "sudo mkdir -p /usr/local/share/ca-certificates/cacert.org",
                "sudo wget -P /usr/local/share/ca-certificates/cacert.org http://www.cacert.org/certs/root.crt http://www.cacert.org/certs/class3.crt",
                "sudo update-ca-certificates",
                "git clone ${RTMP_GIT_URL} rtmp; cd rtmp && git checkout ${RTMP_GIT_BRANCH} && git pull;",
                "if [ ! -f nginx.key ]; then wget -O nginx.key ${NGINX_KEY_URL}; fi",
                "sudo apt-key add nginx.key",
                "echo \"deb ${NGINX_URL}/ $(lsb_release -sc) nginx\" | sudo tee /etc/apt/sources.list.d/nginx.list",
                "echo \"deb-src ${NGINX_URL}/ $(lsb_release -sc) nginx\" | sudo tee -a /etc/apt/sources.list.d/nginx.list",
                "apt-src update && sudo apt-get update && sudo apt-get upgrade -y",
                "apt-src install nginx",
                "sed -i 's#--modules-path=#--add-module=${WORKDIR}/rtmp --modules-path=#g' ./nginx-*/debian/rules",
                "apt-src build nginx",
                "mv ./nginx*.{deb,changes,buildinfo} /project/repo/checkout",
            ]
        },
        "stretch-i386-with-rtmp": {
            "environment": {
                "NGINX_URL": "http://nginx.org/packages/debian",
                "NGINX_KEY_URL": "http://nginx.org/keys/nginx_signing.key",
                "RTMP_GIT_URL": "http://github.com/arut/nginx-rtmp-module.git",
                "RTMP_GIT_BRANCH": "master",
            },
            "buildenv": "stretch-i386",
            "builddeps": [
                "lsb-release",
                "wget",
                "coreutils",
                "apt-src",
                "sudo",
                "python3",
                "python3-apt",
                "git",
                "sed",
                "ca-certificates",
            ],
            "buildcmd": [
                "cd ${WORKDIR}",
                "sudo mkdir -p /usr/local/share/ca-certificates/cacert.org",
                "sudo wget -P /usr/local/share/ca-certificates/cacert.org http://www.cacert.org/certs/root.crt http://www.cacert.org/certs/class3.crt",
                "sudo update-ca-certificates",
                "git clone ${RTMP_GIT_URL} rtmp; cd rtmp && git checkout ${RTMP_GIT_BRANCH} && git pull;",
                "if [ ! -f nginx.key ]; then wget -O nginx.key ${NGINX_KEY_URL}; fi",
                "sudo apt-key add nginx.key",
                "echo \"deb ${NGINX_URL}/ $(lsb_release -sc) nginx\" | sudo tee /etc/apt/sources.list.d/nginx.list",
                "echo \"deb-src ${NGINX_URL}/ $(lsb_release -sc) nginx\" | sudo tee -a /etc/apt/sources.list.d/nginx.list",
                "apt-src update && sudo apt-get update && sudo apt-get upgrade -y",
                "apt-src install nginx",
                "sed -i 's#--modules-path=#--add-module=${WORKDIR}/rtmp --modules-path=#g' ./nginx-*/debian/rules",
                "apt-src build nginx",
                "mv ./nginx*.{deb,changes,buildinfo} /project/repo/checkout",
            ]
        },
    },
}
