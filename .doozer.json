{
    "artifacts": [
        "nginx*.deb",
        "nginx*.changes",
    ],
    "targets": {
        "raspbian-stretch": {
            "environment": {
                "NGINX_URL": "http://nginx.org/packages/debian",
                "NGINX_KEY_URL": "http://nginx.org/keys/nginx_signing.key",
            },
            "buildenv": "raspbian-stretch",
            "builddeps": [
                "lsb-release",
                "wget",
                "coreutils",
                "apt-src",
                "sudo",
                "python3",
                "python3-apt",
                "ca-certificates",
                "build-essential",
                "debhelper",
                "quilt",
                "libssl-dev",
                "libpcre3-dev",
                "zlib1g-dev",
                "git"
            ],
            "buildcmd": [
                "cd ${WORKDIR}",
                "if [ ! -f nginx.key ]; then wget -O nginx.key ${NGINX_KEY_URL}; fi",
                "sudo apt-key add nginx.key",
                "echo \"deb ${NGINX_URL}/ $(lsb_release -sc) nginx\" | sudo tee /etc/apt/sources.list.d/nginx.list",
                "echo \"deb-src ${NGINX_URL}/ $(lsb_release -sc) nginx\" | sudo tee -a /etc/apt/sources.list.d/nginx.list",
                "sudo apt-src update && sudo apt-get update && sudo apt-get upgrade -y",
                "apt-src --build install nginx",
                "mv ./nginx*.{deb,changes,buildinfo} /project/repo/checkout",
            ]
        },
        "raspbian-stretch-with-rtmp": {
            "environment": {
                "NGINX_URL": "http://nginx.org/packages/debian",
                "NGINX_KEY_URL": "http://nginx.org/keys/nginx_signing.key",
                "RTMP_GIT_URL": "http://github.com/arut/nginx-rtmp-module.git",
                "RTMP_GIT_BRANCH": "master",
                "GIT_SSL_NO_VERIFY": "true",
            },
            "buildenv": "raspbian-stretch",
            "builddeps": [
                "lsb-release",
                "wget",
                "coreutils",
                "apt-src",
                "sudo",
                "python3",
                "python3-apt",
                "ca-certificates",
                "build-essential",
                "debhelper",
                "quilt",
                "libssl-dev",
                "libpcre3-dev",
                "zlib1g-dev",
                "git"
            ],
            "buildcmd": [
                "cd ${WORKDIR}",
                "git clone ${RTMP_GIT_URL} rtmp; cd rtmp && git checkout ${RTMP_GIT_BRANCH} && git pull;",
                "if [ ! -f nginx.key ]; then wget -O nginx.key ${NGINX_KEY_URL}; fi",
                "sudo apt-key add nginx.key",
                "echo \"deb ${NGINX_URL}/ $(lsb_release -sc) nginx\" | sudo tee /etc/apt/sources.list.d/nginx.list",
                "echo \"deb-src ${NGINX_URL}/ $(lsb_release -sc) nginx\" | sudo tee -a /etc/apt/sources.list.d/nginx.list",
                "apt-src update && sudo apt-get update && sudo apt-get upgrade -y",
                "apt-src install nginx",
                "sudo sed -i 's#--modules-path=#--add-module=${WORKDIR}/rtmp --modules-path=#g' ./nginx-*/debian/rules",
                "apt-src build nginx",
                "mv ./nginx*.{deb,changes,buildinfo} /project/repo/checkout",
            ]
        },
        "stretch-amd64-with-rtmp": {
            "environment": {
                "NGINX_URL": "http://nginx.org/packages/debian",
                "NGINX_KEY_URL": "http://nginx.org/keys/nginx_signing.key",
                "RTMP_GIT_URL": "http://github.com/arut/nginx-rtmp-module.git",
                "RTMP_GIT_BRANCH": "master",
                "GIT_SSL_NO_VERIFY": "true",
            },
            "buildenv": "stretch-amd64",
            "builddeps": [
                "lsb-release",
                "wget",
                "coreutils",
                "apt-src",
                "sudo",
                "python3",
                "python3-apt",
                "ca-certificates",
                "build-essential",
                "debhelper",
                "quilt",
                "libssl-dev",
                "libpcre3-dev",
                "zlib1g-dev",
                "git"
            ],
            "buildcmd": [
                "cd ${WORKDIR}",
                "git clone ${RTMP_GIT_URL} rtmp; cd rtmp && git checkout ${RTMP_GIT_BRANCH} && git pull;",
                "if [ ! -f nginx.key ]; then wget -O nginx.key ${NGINX_KEY_URL}; fi",
                "sudo apt-key add nginx.key",
                "echo \"deb ${NGINX_URL}/ $(lsb_release -sc) nginx\" | sudo tee /etc/apt/sources.list.d/nginx.list",
                "echo \"deb-src ${NGINX_URL}/ $(lsb_release -sc) nginx\" | sudo tee -a /etc/apt/sources.list.d/nginx.list",
                "apt-src update && sudo apt-get update && sudo apt-get upgrade -y",
                "apt-src install nginx",
                "sudo sed -i 's#--modules-path=#--add-module=${WORKDIR}/rtmp --modules-path=#g' ./nginx-*/debian/rules",
                "apt-src build nginx",
                "mv ./nginx*.{deb,changes,buildinfo} /project/repo/checkout",
            ]
        },
        "stretch-i386-with-rtmp": {
            "environment": {
                "NGINX_URL": "http://nginx.org/packages/debian",
                "NGINX_KEY_URL": "http://nginx.org/keys/nginx_signing.key",
                "RTMP_GIT_URL": "http://github.com/arut/nginx-rtmp-module.git",
                "RTMP_GIT_BRANCH": "master",
                "GIT_SSL_NO_VERIFY": "true",
            },
            "buildenv": "stretch-i386",
            "builddeps": [
                "lsb-release",
                "wget",
                "coreutils",
                "apt-src",
                "sudo",
                "python3",
                "python3-apt",
                "ca-certificates",
                "build-essential",
                "debhelper",
                "quilt",
                "libssl-dev",
                "libpcre3-dev",
                "zlib1g-dev",
                "git"
            ],
            "buildcmd": [
                "cd ${WORKDIR}",
                "git clone -v ${RTMP_GIT_URL} rtmp; cd rtmp && git checkout ${RTMP_GIT_BRANCH} && git pull;",
                "if [ ! -f nginx.key ]; then wget -O nginx.key ${NGINX_KEY_URL}; fi",
                "sudo apt-key add nginx.key",
                "echo \"deb ${NGINX_URL}/ $(lsb_release -sc) nginx\" | sudo tee /etc/apt/sources.list.d/nginx.list",
                "echo \"deb-src ${NGINX_URL}/ $(lsb_release -sc) nginx\" | sudo tee -a /etc/apt/sources.list.d/nginx.list",
                "sudo apt-src update && sudo apt-get update && sudo apt-get upgrade -y",
                "sudo apt-src install nginx",
                "sudo sed -i 's#--modules-path=#--add-module=${WORKDIR}/rtmp --modules-path=#g' ./nginx-*/debian/rules",
                "sudo apt-src build nginx",
                "mv ./nginx*.{deb,changes,buildinfo} /project/repo/checkout",
            ]
        },
    },
}
